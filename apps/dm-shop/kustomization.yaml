apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 1. List all the base resource files
resources:
- base/deployment.yaml
- base/config-map.yaml
- base/service-account.yaml
- base/ingress.yaml

# 2. Set the image tag for the Deployment
# This is a key feature of Kustomize: easily updating the image tag.
images:
- name: johnnguyendeveloper/dm-shop:latest # Reference the base image name without the tag

# ----------------------------------------------------
# ADD THIS BLOCK: Kustomize generates the secret securely
# ----------------------------------------------------
secretGenerator:
- name: dockerhub-credentials # The name the ServiceAccount is looking for
  type: kubernetes.io/dockerconfigjson
  # Use the 'literal' option to pass your credentials directly.
  # This line will create the required Base64-encoded Secret content.
  literals:
  - .dockerconfigjson={"auths":{"index.docker.io/v1/":{"username":"johnnguyendeveloper","password":"dckr_pat_7H4ft4yxSlgD9xf07Td4yrZs7HE","email":"johnnguyendeveloper@gmail.com"}}}

# Note: Kustomize is smart enough to handle the JSON structure here.
# However, the most robust way to use `literals` is to supply the
# Base64-encoded `.dockerconfigjson` string itself, which is complex.
# A simpler and more common pattern is to use a separate file for the credentials:
# ----
